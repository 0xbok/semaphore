<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title><%= htmlWebpackPlugin.options.title %></title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
  <link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.indigo-pink.min.css">
  <link rel="stylesheet" href="https://cdn.datatables.net/1.10.19/css/jquery.dataTables.min.css">
  <script defer src="https://code.getmdl.io/1.3.0/material.min.js"></script>
  <script
  src="https://code.jquery.com/jquery-3.4.0.min.js"
  integrity="sha256-BJeo0qm959uMBGb65z40ejJYGSgR7REI4+CW1fNKwOg="
  crossorigin="anonymous"></script>
  <script src="https://cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js"></script>

  <style>
    .mdl-textfield {
      width: 600px;
    }
  </style>

  <form action="#">
    <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
      <input class="mdl-textfield__input" type="text" id="f_node_url" value="wss://rinkeby.infura.io/ws/v3/f4a3ad81db3f4750bd201955c8d20066">
      <label class="mdl-textfield__label" for="f_node_url">Node URL...</label>
    </div>
    <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
      <input class="mdl-textfield__input" type="text" id="f_external_nullifier" value="12312">
      <label class="mdl-textfield__label" for="f_external_nullifier">External nullifier...</label>
    </div>
    <br />
    <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
      <input class="mdl-textfield__input" type="text" id="f_semaphore_server_url" value="http://semaphore-server.kobi.one">
      <label class="mdl-textfield__label" for="f_semaphore_server_url">Semaphore server url...</label>
    </div>
    <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
      <input class="mdl-textfield__input" type="text" id="f_semaphore_contract_address" value="0xa32353Eb1e1Aa0fEA5e1Fee98769592bF842EE43">
      <label class="mdl-textfield__label" for="f_semaphore_contract_address">Semaphore contract address...</label>
    </div>
    <br />
    <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
      <input class="mdl-textfield__input" type="text" id="f_from_private_key" value="0x6738837df169e8d6ffc6e33a2947e58096d644fa4aa6d74358c8d9d57c12cd21">
      <label class="mdl-textfield__label" for="f_from_private_key">Ethereum private key...</label>
    </div>
    <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
      <input class="mdl-textfield__input" type="text" id="f_from_address" value="0x1929c15f4e818abf2549510622a50c440c474223">
      <label class="mdl-textfield__label" for="f_from_address">Ethereum address...</label>
    </div>
    <br />
    <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
      <input class="mdl-textfield__input" type="text" id="f_chain_id" value="4">
      <label class="mdl-textfield__label" for="f_chain_id">Chain ID...</label>
    </div>
    <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
      <input class="mdl-textfield__input" type="text" id="f_tx_confirm" value="1">
      <label class="mdl-textfield__label" for="f_tx_confirm">Transaction confirmation blocks...</label>
    </div>
  </form>

  <button id="btn_connect" class="mdl-button mdl-js-button mdl-button--raised">
  Connect
</button>

<table class="mdl-data-table mdl-js-data-table mdl-data-table--selectable mdl-shadow--2dp">
  <tbody>
    <tr>
      <td class="mdl-data-table__cell--non-numeric">Block number</td>
      <td id="s_block_number">Not yet...</td>
    </tr>
    <tr>
      <td class="mdl-data-table__cell--non-numeric">Root</td>
      <td id="s_root">Not yet...</td>
    </tr>
    <tr>
      <td class="mdl-data-table__cell--non-numeric">Rolling hash</td>
      <td id="s_rolling_hash">Not yet...</td>
    </tr>
    <tr>
      <td class="mdl-data-table__cell--non-numeric">External nullifier</td>
      <td id="s_external_nullifier">Not yet...</td>
    </tr>
  </tbody>
</table>

  <table id="signals" class="mdl-data-table mdl-js-data-table mdl-shadow--2dp" style="margin-top: 5px;">
    <thead>
        <tr>
            <th>Signal</th>
            <th>Nullifiers hash</th>
            <th>External nullifier</th>
            <th>Block number</th>
            <th>Rolling hash</th>
        </tr>
    </thead>
  </table>

<div class="mdl-grid">
  <div class="mdl-cell mdl-cell--4-col">
    <div class="demo-card-wide mdl-card mdl-shadow--2dp" style="width: 100%">
      <h4>Broadcast</h4>
      <form action="#">
        <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
          <input class="mdl-textfield__input" type="text" id="b_signal">
          <label class="mdl-textfield__label" for="b_signal">Signal string</label>
        </div>
      </form>

      <button id="btn_broadcast" class="mdl-button mdl-js-button mdl-button--raised">
        Broadcast
      </button>
    </div>
  </div>

  <div class="mdl-cell mdl-cell--4-col">
    <div class="demo-card-wide mdl-card mdl-shadow--2dp" style="width: 100%">
      <h4>Identity</h4>
      <div class="mdl-card__supporting-text" id="d_identity" style="word-break: break-all;">
        No identity loaded...
      </div>
      <div class="mdl-card__actions mdl-card--border">
        <button id="btn_generate" class="mdl-button mdl-js-button mdl-button--raised" onclick="window.generated = window.generate_identity(logger); display_identity();">Generate</button>
        <button id="btn_save" class="mdl-button mdl-js-button mdl-button--raised" onclick="download(JSON.stringify(window.generated), 'semaphore_identity.json', 'application/json')">Save</button>
        <button id="btn_load" class="mdl-button mdl-js-button mdl-button--raised">Load</button>
      </div>
    </div>
  </div>

  <div class="mdl-cell mdl-cell--4-col">
    <div class="demo-card-wide mdl-card mdl-shadow--2dp" style="width: 100%">
      <h4>Status</h4>
      <span class="mdl-card__supporting-text" id="d_status" style="word-break: break-all;">
        Perform an operation...
      </span>
      <span id="d_broadcasting" class="mdl-spinner mdl-js-spinner is-active" style="display: none;"></span>
    </div>
  </div>
</div>

<div class="demo-card-wide mdl-card mdl-shadow--2dp" style="width: 100%">
  <h4>Add identity</h4>
  <form action="#">
    <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
      <input class="mdl-textfield__input" type="text" id="a_comm">
      <label class="mdl-textfield__label" for="a_comm">Identity commitment</label>
    </div>
    <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
      <input class="mdl-textfield__input" type="text" id="a_login">
      <label class="mdl-textfield__label" for="a_login">Login</label>
    </div>
  </form>

  <button id="btn_add_identity" class="mdl-button mdl-js-button mdl-button--raised">
    Add identity
  </button>
</div>

<input type="file" id="files" name="files" style="display: none;"/>

<script>
  function handleFileSelect(evt) {
    var files = evt.target.files; // FileList object
    var reader = new FileReader();

    reader.onload = function(e) {
      window.generated = JSON.parse(reader.result);
      display_identity();
    }

    reader.readAsText(files[0]);

  }

  document.getElementById('files').addEventListener('change', handleFileSelect, false);
  $('#btn_load').click( () => {
    $('#files').click();
  });
</script>

  <script>
  $(document).ready(function() {
    $.extend($.fn.dataTable.defaults, {
        searching: false,
        ordering:  false
    });

    window.signals_table = $('#signals').DataTable({
        "searching": false,
        "processing": true,
        "serverSide": true,
        "ajax": $('#f_semaphore_server_url').val() + "/signals_datatable",
				"columnDefs": [
					{ "orderable": true, "targets": 0 }
				],
        "columns": [
            { "data": "signal" },
            { "data": "nullifiers_hash" },
            { "data": "external_nullifier" },
            { "data": "block_number" },
            { "data": "rolling_hash" },
        ]
    });
  });
  </script>
</head>
<body>
</body>
</html>
